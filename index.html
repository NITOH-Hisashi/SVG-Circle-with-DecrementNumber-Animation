<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Countdown Animation</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>

    <div id="controls">
        <input type="number" id="countdown-seconds" placeholder="秒数を入力" min="1" value="180">
        <button id="start-button">カウントダウン開始</button>
    </div>

    <div class="svg-container">
        <svg width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <circle id="circle" cx="100" cy="100" r="80" stroke="black" stroke-width="8" fill="none" class="circle" />
            <text x="100" y="116" id="number"></text>
        </svg>
    </div>

    <script>
        let countdownInterval;

        function startCountdown(seconds) {
            const circle = document.getElementById('circle');
            const numberText = document.getElementById('number');

            let currentNumber = seconds;

            function decrementNumber() {
                // 一旦アニメーションをリセット
                circle.classList.remove('animate');
                circle.classList.add('reset');

                currentNumber--;
                numberText.textContent = currentNumber;
                if (currentNumber > 0) {
                    animateCircle();
                }
            }

            function animateCircle() {
                //setTimeout(function () {
                circle.classList.remove('reset');
                void circle.offsetWidth; // Reflowをトリガー

                setTimeout(function () {
                    circle.classList.add('animate');
                }, 50); // 50ミリ秒の待ち時間
                //}, 1); // 1ミリ秒の待ち時間
            }

            // 初期値をセット
            numberText.textContent = currentNumber;
            animateCircle();

            countdownInterval = setInterval(() => {
                decrementNumber();
                if (currentNumber <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000); // 1000ミリ秒ごとにカウントダウン
        }

        document.addEventListener('DOMContentLoaded', function () {
            const startButton = document.getElementById('start-button');
            const countdownInput = document.getElementById('countdown-seconds');

            function startCountdownFromInput() {
                const countdownSeconds = parseInt(countdownInput.value, 10);
                if (isNaN(countdownSeconds) || countdownSeconds <= 0) {
                    alert('有効な秒数を入力してください');
                    return;
                }

                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }

                startCountdown(countdownSeconds);
            }

            startButton.addEventListener('click', startCountdownFromInput);
            countdownInput.addEventListener('keypress', function (event) {
                if (event.key === 'Enter') {
                    startCountdownFromInput();
                }
            });

        });
    </script>

</body>

</html>
